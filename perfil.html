<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>APTUM - Perfil</title>
      <link rel="stylesheet" href="css.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> <!--link do bootsrap-->
      <link rel="shortcut icon"  href="imagens/APTUMicon2.png">

      <script src="https://code.jquery.com/jquery-3.3.1.js"></script> <!--link do jquery-->
      
	<script src="moment.min.js"></script>
	<script src="Chart.js"></script>
	<script src="utils.js"></script>
</head>
      <body>
      <div class="wrapper"><!--Um wrapper é algo que envolve um único objeto para fornecer mais funcionalidade e interface para ele-->
            
                <nav> <!-- conjunto de links de navegação.-->
                    <div class="menu-icon">
                        <i class="fa fa-bars fa-2x"></i><!--para ter o icone e o tamanho-->
                    </div>

                    <div class="logo"><!--A class onde insere o logo-->
                        <img src="imagens/aptum.png">
                    </div>

                    <div class="menu" id="desce">
                        <ul>
                              <a href="#Home"><li>Home</li></a>
                              <a href="#Produto"><li>E-Scale</li></a>
                              <a href="#Empresa"><li>APTUM™</li></a>
                              <a href="#Contatos"><li>Contatos</li></a>
                              <li class='semBorda'><a href="#" class="l">Login</a><a href="#" class="l">Cadastre-se</a></li> <!--Class 'semBorda' usada na tag <li> botão login pra não ter borda quando dar hover-->

                        </ul>
                    </div>
                </nav>
                      

          <div class="paginaGraf">
              <div id="areaGraf">
                  
                  <canvas id="chart"></canvas>
              </div>
              
              <div id="areaTerm">
					<div class="termTolerancia">
                        <div id="tolerancia">
                      
                        </div>
					</div>
                  <div id="termTrack">
                        <div id="termBar">
                      
                        </div>
                  </div>
                  <div class="termHiddenTrack">
                        <div id="txtTemp">
                      
                        </div>
                  </div>
              </div>
              <div id="areaDados">
				<div id='tituloDados'>Dados dos ultimos 15 registros</div>
				<div id='areaCirculo'>
					<div class='espaçoCirculo'>
						<div class='tituloCirculo'></div>
						<div class='circuloDadosCima' id='Media'></div>
						<div class='tituloCirculo'>Média</div>
					</div>
					
					<div class='espaçoCirculo'>
						<div class='tituloCirculo'></div>
						<div class='circuloDadosCima' id="DesvPad"></div>
						<div class='tituloCirculo'>Desvio Padrão</div>
					</div>
					
					<div class='espaçoCirculo'>
						<div class='tituloCirculo'>Moda</div>
						<div class='circuloDadosCima' style="padding-top: 0; height: 70px;">
							<div class='lugarzinhoNoCirculo' id='Moda'></div>
							
							<div class='lugarzinhoNoCirculo' id='Freq'></div>
						</div>
						<div class='tituloCirculo'>Frequência</div>
					</div>
					
				</div>
			  </div>
          </div>
      </div>
            <footer>
            <div class="rodape" id="Contatos">
			
				<div class='areasRodape'>
					<div class='tituloAreaRodape'>Localização</div>
					<div class='icone'>
						<img src='imagens/local.png'>
					</div>
					<div class='conteudoAreaRodape'>
						Rua Haddock Lobo
						<br> 595
					</div>			
					<div class='conteudoAreaRodape'>
						Cerqueira César 
						<br>São Paulo - SP
					</div>
				</div>
				
				<div class='areasRodape'>
				
					<div class='tituloAreaRodape'>Redes Sociais</div>
					<br>
					<div class='icone'>
						<a href="http://facebook.com"><img src='imagens/facebook2.png'></a>
					</div>
					<div class='icone'>
						<a href="http://facebook.com"><img src='imagens/twitter2.png'></a>
					</div>
					<div class='icone'>
						<a href="http://facebook.com"><img src='imagens/instagram2.png'></a>
					</div>
					<div class='icone'>
						<a href="http://facebook.com"><img src='imagens/linkedin2.png'></a>
					</div>
					<div class='icone'>
						<a href="http://facebook.com"><img src='imagens/g+2.png'></a>
					</div>
				</div>
				
				<div class='areasRodape'>
					<div class='tituloAreaRodape' style="border-top: solid 0px;">Fale conosco</div> <!--Mudem pra a border-top pra 1px se quiserem a linha no meio do rodapé-->
					<div class='icone'>
						<img src='imagens/contato.png'>
					</div>
					<div class='conteudoAreaRodape'>0800 777 7000
						<br> 4002-8922
					</div>			
					<div class='conteudoAreaRodape'>APTUM Enterprise
						<br> APTUM@gmail.com
					</div>
				</div>
				
				<div class='areasRodape'>
					<div class='tituloAreaRodape' style="border-top: solid 0px;">Alguma Dúvida?</div> <!--Mudem pra a border-top pra 1px se quiserem a linha no meio do rodapé-->
					<div class='icone'>
						<img src='imagens/duvidas.png'>
					</div>
					
					<div class="botaoj">Ajuda</div>
				</div>
				
				<div class="areaRodapeDireitosReservados">
					APTUM™
					<br>
					2018
					<br>
					Todos os direitos reservados
					<br>
					<div class='icone'>
						<img src='imagens/camaleaoicon.png'>
					</div>
				</div>
				
            </div>
        </footer>

             <script type="text/javascript">
                 
                 var menu = document.getElementById('desce'); //Coloca o elemento com o ID 'menu' em uma variavel
                 menu.style.marginTop='-100px'; // Muda a margin-top do menu pra -100px
                 
                 onload = function(){ //qndo a pagina carrega essa função é ativada
                     menu.style.transition='0.5s ease-in'; //muda a transição do menu pra um tempo de 0.5 segundos e ease-in(mais lento no começo da transição)
                     menu.style.marginTop='0'; //Muda a margin-top do menu de volta pra 0
                     
                 };

      // Scrolling Effect
	
      $(window).on("scroll load", function() { //Rola a janela para uma posição específica no documento e a tag "scroll" e uma tag que faz a exibição do objeto.
                  $('nav').addClass('black');//Onde as condiçoes são quando a barra de navegação conhecida como "nav" nao estiver no topo vai adicionar a "cor" escolhida
            
      });
	  
	  
	  //Rolagem lisa qndo clica nos links do menu
	  $(document).ready(function(){
	  
	  $("a").on('click', function(event) { // Adiciona rolagem pra todos os links (tag <a>)

		
		if (this.hash !== "") { // ativa "Se href do link não tiver vazio"
		  
		  event.preventDefault(); // Previne comportamentos padrão qndo clica em links

		  
		  var hash = this.hash; //  Guarda o 'href' em uma variavel

		  //Usando o método animate() do jQuery pra adicionar a rolagem lisa
		  $('html, body').animate({
			scrollTop: $(hash).offset().top
		  }, 800, function(){ // O número (800) é quantos milisegundos demora pra rolar até o local
	   
			
			window.location.hash = hash; // Adiciona hash (#) no URL (endereço da pagina) quando termina de rolar (Isso é um comportamento padrão só q foi prevenido lá em cima)
		  });
		} // Fim do if
	  });
	});

        







        /*----------------------------------------------Tentem entender a index da Marise antes-------------------------------------------------*/
        var context = document.getElementById("chart").getContext("2d");
		context.canvas.height='100';
                context.canvas.width='250';
        
        
        var configuration = {
			type: 'line',
                        
			data: {
                            
				datasets: [{
					label: "Temperatura por segundo",
					type: 'line',
                    fill: true,
					backgroundColor: "rgba(230,230,230,0.8)",
					borderColor: "rgba(230,230,230,1)",
					borderWidth: 2,
                    pointRadius: 10,
					pointHoverRadius: 15,
                    showLine: true
                                        
				}]
			},
                       
			options: {
				legend: {
					labels: {
						fontColor: "rgb(230,230,230)",
						fontSize: 11
					}
				},
                responsive: true,
				title: {
					display: true,
					text: 'AMBIENTE 1',
                    fontColor: "rgba(230,230,230,1)"
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						//type: 'value',
                        fontColor: "rgba(230,230,230,0.7)",
                        display: false,
						distribution: 'series',
						ticks: {
							fontColor: "rgba(230,230,230,1)",
							beginAtZero:true,
						}
					}],
					yAxes: [{
						scaleLabel: {
                            fontColor: "rgba(230,230,230,0.7)",
							display: true,
							labelString: 'Temperatura'
                        },
						ticks: {
							fontColor: "rgba(230,230,230,1)",
							beginAtZero:true
						}
					}]
				},
				animation: {
					duration: 100,
				}
			}
        };
        
		var chart = new Chart(context, configuration);

        //Função para obter os dados de temperatura do server
        //Seria mais interessante fazer isso com WebSocket, porém para fins academicos, os dados serão atualizados via HTTP
        
        //Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
        //hora de montar/atualizar o gráfico
        this.lastIndexTemp = 0;
        this.time = 0;
        var obj = [5,6];
        var termometro = document.getElementById('termBar');
        var txtTemp = document.getElementById('txtTemp');
        var escala = 0.5;
        
        
        
        var toleranciamax = 32;
        var toleranciamin = 22;
        var tolerancia = document.getElementById('tolerancia');
        tolerancia.style.height=(toleranciamax-toleranciamin)*escala+'%';
        tolerancia.style.top=(100-toleranciamax)*escala+"%";
        tolerancia.style.bottom='auto';
        
        
        var txtMedia = document.getElementById('Media');
        var txtModa = document.getElementById('Moda');
        var txtFreq = document.getElementById('Freq');
        var txtDesvPad = document.getElementById('DesvPad');
		
        
        function get_data(){
		
            var http = new XMLHttpRequest();
            http.open('GET', 'http://localhost:3000/api', false);
            http.send(null);        
	
            
            var objeto = JSON.parse(http.responseText);
			
            if (objeto.data.length === 0){
                return;
            }
			
            obj = objeto.data;
      
    /*        obj[obj.length] = obj[obj.length-1]+(Math.floor(Math.random()*5)-2); */
            
          
            if(obj[obj.length-1]<0){
                
                termometro.style.top='50%';
                
                termometro.style.bottom='auto';
                termometro.style.height=(obj[obj.length-1]*-1)*escala+'%';
                txtTemp.style.top = 46+(obj[obj.length-1]*-1)*escala+'%';
                txtTemp.style.bottom = 'auto';
            }
            else{
                termometro.style.top='auto';
                termometro.style.bottom='50%';
                termometro.style.height=(obj[obj.length-1])*escala+'%';
                
                txtTemp.style.bottom = 46+(obj[obj.length-1])*escala+'%';
                txtTemp.style.top = 'auto';
            }
            
            if(obj[obj.length-1]>toleranciamax){
                termometro.style.backgroundColor='rgba(230,90,80,1)';
            }
            else if(obj[obj.length-1]<toleranciamin){
                termometro.style.backgroundColor='rgba(40,90,200,1)';
            }
            else{
                termometro.style.backgroundColor='rgba(230,230,230,1)';
            }
            
            txtTemp.textContent = obj[obj.length-1]+"°C";
            
            if (obj.length === 0){
                return;
            }
            var _lastIndexTemp = this.lastIndexTemp;
            this.lastIndexTemp = obj.length;
            listTemp = obj.slice(_lastIndexTemp);
            listTemp.forEach(data => {
                //Máximo de 60 itens exibidos no gráfico
                if (chart.data.labels.length == 10 && chart.data.datasets[0].data.length == 10){
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                }

                chart.data.labels.push(this.time++);
                chart.data.datasets[0].data.push(parseFloat(data));
                chart.update();
			});
			
			
			
			
			//---------------------------MÉDIA---------------------------------------
			var base;
			var listaDados = [];
			
			if(obj.length-1<16){
				base = obj.length-1;
			}
			else{
				base = 15;
			}
			
			var media = 0;
			for(i=base;i>=1;i--){
				media +=  obj[obj.length-i];
				listaDados.push(obj[obj.length-i]);
			}
			media = media/base;
			txtMedia.textContent=media.toFixed(1)+"°C";
			//------------------------------------------------------------------------
			
			
			moda(listaDados);
			desvioPadrao(media, listaDados);
			
		} 
                
        setInterval(() => {
            get_data();
        }, 1000);
        
		
		
		function moda(lista){
			var msg = "\n ";
			var freq = 0;
			var qtdRepete = []; //Array q conta qntas vezes o numero repete
			for(i = 0; i<lista.length; i++){
				var numComp = lista[i];
				qtdRepete[i] = 0; //Começa no 0
				
				for(j = 0; j<lista.length; j++){
					if(numComp == lista[j]){
						qtdRepete[i]++; // Se o numero aparecer aumenta 1 (ele aparece ao menos 1 vez)
					}
				}
				msg+="O número "+numComp+" se repete: "+qtdRepete[i]+" vez(es)\n ";
			}
			
			var qtd = 0;
			var indexMaisRepete = 0;
			for(i = 0; i<qtdRepete.length; i++){
				if(qtdRepete[i] > qtd){
					qtd = qtdRepete[i];
					indexMaisRepete = i;
					freq = ((qtd*100)/lista.length).toFixed(0);
				}
			}
			
			txtModa.textContent = lista[indexMaisRepete]+"°C";
			txtFreq.textContent = freq+"%";
			//window.alert(indexMaisRepete+" "+qtd);
			//window.alert(msg + "\n numero "+ lista[indexMaisRepete]+" indice: "+indexMaisRepete+" repete: "+qtd);
		}
		
		function desvioPadrao(media, lista){
			var variancia = 0;
			var desvioPadrao;
			
			for(i=0; i<lista.length; i++){
				variancia += (lista[i]-media) * (lista[i]-media);
			}
			variancia = variancia/lista.length;
			desvioPadrao = Math.sqrt(variancia);
			txtDesvPad.textContent = desvioPadrao.toFixed(2)+"°C";
		}
      </script>
     
</body>
</html>